#!/bin/bash

echo "ğŸ§¼ [1] ArrÃªt des expÃ©riences IMUNES..."
for eid in $(himage -l | awk '{print $1}'); do
    echo "  -> Suppression de l'expÃ©rience $eid"
    imunes -b -e "$eid"
done

echo "ğŸ”ª [2] Kill des processus restants..."
pkill -f imunes
pkill -f socat
pkill -f X11-unix
pkill -f unshare
pkill -f namespace
pkill -f ip netns
sleep 1

echo "ğŸ§¹ [3] Suppression des namespaces..."
for ns in $(ip netns list | awk '{print $1}'); do
    echo "  -> Suppression namespace $ns"
    ip netns delete "$ns"
done

echo "ğŸ“ [4] Suppression des fichiers rÃ©siduels..."
rm -rf /var/run/imunes/*
rm -rf /var/imunes/*

echo "ğŸ”Œ [5] Nettoyage des interfaces WiFi simulÃ©es..."
modprobe -r mac80211_hwsim
modprobe mac80211_hwsim radios=0

echo "âœ… Nettoyage complet terminÃ© !"
